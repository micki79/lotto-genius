name: ğŸ€ LottoGenius Multi-KI Analyse

on:
  schedule:
    # Lotto 6aus49: Mi 20:00 UTC (nach 18:25 Ziehung), Sa 21:00 UTC (nach 19:25)
    - cron: '0 19 * * 3'
    - cron: '0 20 * * 6'
    # Eurojackpot: Di 21:00 UTC (nach 20:00 Ziehung), Fr 21:00 UTC (nach 20:00)
    - cron: '0 20 * * 2'
    - cron: '0 20 * * 5'
    # Sonntag 03:00 UTC: WÃ¶chentliche Optimierung
    - cron: '0 2 * * 0'
  workflow_dispatch:

jobs:
  analyze:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      HUGGINGFACE_API_KEY: ${{ secrets.HUGGINGFACE_API_KEY }}
      OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
      TOGETHER_API_KEY: ${{ secrets.TOGETHER_API_KEY }}
      DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}

    steps:
      - name: ğŸ“¥ Repository auschecken
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ Python einrichten
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ğŸ“¦ Dependencies installieren
        run: pip install requests numpy

      # ===== LOTTO 6aus49 =====
      - name: ğŸ° Lotto-Daten aktualisieren
        run: python scripts/fetch_data.py

      - name: ğŸ“Š Lotto 6aus49 KI-Analyse durchfÃ¼hren
        run: python scripts/analyze.py

      - name: ğŸ§  Lotto 6aus49 - Aus Vorhersagen lernen
        run: python scripts/learn.py

      - name: ğŸ”® Lotto 6aus49 - Neue Multi-KI Vorhersagen generieren
        run: python scripts/predict.py

      # ===== EUROJACKPOT =====
      - name: ğŸŒŸ Eurojackpot KI-Analyse durchfÃ¼hren
        run: python scripts/analyze_eurojackpot.py

      - name: ğŸ§  Eurojackpot - Aus Vorhersagen lernen
        run: python scripts/learn_eurojackpot.py

      - name: ğŸ”® Eurojackpot - Neue Multi-KI Vorhersagen generieren
        run: python scripts/predict_eurojackpot.py

      - name: ğŸ“¤ Ã„nderungen committen
        run: |
          git config --local user.email "lotto-genius-bot@github.com"
          git config --local user.name "ğŸ€ LottoGenius Bot"
          git add -A
          if git diff --quiet && git diff --staged --quiet; then
            echo "Keine Ã„nderungen"
          else
            git commit -m "ğŸ¤– Auto-Update: $(date '+%Y-%m-%d %H:%M')"
            git push
          fi
